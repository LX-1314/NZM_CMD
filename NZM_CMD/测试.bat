@echo off
setlocal

:: ========================================================
:: 1. 自动获取管理员权限 (Auto Admin)
::    如果不获取管理员权限，模拟鼠标键盘会被 Windows 拦截
:: ========================================================
fltmc >nul 2>&1 || (
    echo [INFO] 正在申请管理员权限...
    PowerShell Start-Process -FilePath '%0' -Verb RunAs
    exit /b
)

:: ========================================================
:: 2. 设置运行环境
:: ========================================================
:: 切换到当前脚本所在的目录
cd /d "%~dp0"

:: 设置窗口标题
title NZM_CMD 自动挂机

:: ========================================================
:: 3. 配置参数 (在这里修改)
:: ========================================================
:: 程序文件名 (如果你的exe名字不一样，请修改这里)
set EXE_NAME=nzm_cmd.exe

:: 端口号 (硬件用 COMx, 软件模拟用 SOFT)
set PORT=SOFT

:: 任务目标 (例如: "赛季任务", "空间站普通", "每日目标")
set TARGET=空间站普通

:: ========================================================
:: 4. 启动程序
:: ========================================================
echo.
echo   ? 正在启动: %EXE_NAME%
echo   ? 端口模式: %PORT%
echo   ? 执行任务: %TARGET%
echo.

if not exist "%EXE_NAME%" (
    echo [ERROR] 找不到文件: %EXE_NAME%
    echo 请确保本脚本和 exe 文件在同一个文件夹内！
    pause
    exit /b
)

:: 执行命令
"%EXE_NAME%" -p %PORT% -t "%TARGET%"

:: ========================================================
:: 5. 执行结束
:: ========================================================
echo.
if %errorlevel% neq 0 (
    echo ? 程序异常退出 (代码: %errorlevel%)
) else (
    echo ? 程序执行完毕
)

echo 按任意键关闭窗口...
pause >nul